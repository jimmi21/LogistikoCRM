{% extends "reports/base_report.html" %}

{% block title %}Αναφορά Πελάτη - {{ client.eponimia }}{% endblock %}

{% block content %}
<div class="header">
    <h1>{{ client.eponimia }}</h1>
    <p class="subtitle">ΑΦΜ: {{ client.afm }}{% if client.doy %} | ΔΟΥ: {{ client.doy }}{% endif %}</p>
</div>

<!-- Statistics -->
<table class="stats-table">
    <tr>
        <td>
            <div class="stat-label">Σύνολο</div>
            <div class="stat-number">{{ stats.total }}</div>
        </td>
        <td>
            <div class="stat-label">Ολοκληρωμένες</div>
            <div class="stat-number stat-number-completed">{{ stats.completed }}</div>
        </td>
        <td>
            <div class="stat-label">Εκκρεμείς</div>
            <div class="stat-number stat-number-pending">{{ stats.pending }}</div>
        </td>
        <td>
            <div class="stat-label">Καθυστερημένες</div>
            <div class="stat-number stat-number-overdue">{{ stats.overdue }}</div>
        </td>
    </tr>
</table>

<!-- Client Info -->
<h2>Στοιχεία Πελάτη</h2>
<table class="info-table">
    <tr>
        <td class="info-label">Επωνυμία:</td>
        <td class="info-value">{{ client.eponimia }}</td>
        <td class="info-label">ΑΦΜ:</td>
        <td class="info-value">{{ client.afm }}</td>
    </tr>
    {% if client.doy or client.email %}
    <tr>
        {% if client.doy %}
        <td class="info-label">ΔΟΥ:</td>
        <td class="info-value">{{ client.doy }}</td>
        {% else %}
        <td></td><td></td>
        {% endif %}
        {% if client.email %}
        <td class="info-label">Email:</td>
        <td class="info-value">{{ client.email }}</td>
        {% else %}
        <td></td><td></td>
        {% endif %}
    </tr>
    {% endif %}
    {% if client.kinito_tilefono or client.tilefono_epixeirisis_1 %}
    <tr>
        {% if client.kinito_tilefono %}
        <td class="info-label">Κινητό:</td>
        <td class="info-value">{{ client.kinito_tilefono }}</td>
        {% else %}
        <td></td><td></td>
        {% endif %}
        {% if client.tilefono_epixeirisis_1 %}
        <td class="info-label">Τηλέφωνο Επιχ.:</td>
        <td class="info-value">{{ client.tilefono_epixeirisis_1 }}</td>
        {% else %}
        <td></td><td></td>
        {% endif %}
    </tr>
    {% endif %}
    {% if client.eidos_ipoxreou or client.katigoria_vivlion %}
    <tr>
        {% if client.eidos_ipoxreou %}
        <td class="info-label">Είδος Υπόχρεου:</td>
        <td class="info-value">{{ client.get_eidos_ipoxreou_display }}</td>
        {% else %}
        <td></td><td></td>
        {% endif %}
        {% if client.katigoria_vivlion %}
        <td class="info-label">Κατηγορία Βιβλίων:</td>
        <td class="info-value">{{ client.get_katigoria_vivlion_display }}</td>
        {% else %}
        <td></td><td></td>
        {% endif %}
    </tr>
    {% endif %}
</table>

<!-- Obligations Table -->
<h2>Υποχρεώσεις ({{ stats.total }})</h2>
{% if obligations %}
<table>
    <thead>
        <tr>
            <th style="width: 25%;">Τύπος</th>
            <th style="width: 15%;">Περίοδος</th>
            <th style="width: 18%;">Προθεσμία</th>
            <th style="width: 15%;">Κατάσταση</th>
            <th style="width: 18%;">Ολοκλήρωση</th>
        </tr>
    </thead>
    <tbody>
        {% for ob in obligations %}
        <tr class="{% cycle 'row-light' 'row-dark' %}">
            <td>{{ ob.obligation_type.name }}</td>
            <td>{{ ob.month|stringformat:"02d" }}/{{ ob.year }}</td>
            <td>{{ ob.deadline|date:"d/m/Y" }}</td>
            <td>
                {% if ob.status == 'completed' %}
                <span class="status-badge status-completed">Ολοκληρώθηκε</span>
                {% elif ob.status == 'overdue' %}
                <span class="status-badge status-overdue">Καθυστερεί</span>
                {% else %}
                <span class="status-badge status-pending">Εκκρεμεί</span>
                {% endif %}
            </td>
            <td>
                {% if ob.completed_date %}
                {{ ob.completed_date|date:"d/m/Y" }}
                {% else %}
                —
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p style="color: #666666; text-align: center; padding: 20px;">Δεν υπάρχουν υποχρεώσεις για αυτόν τον πελάτη.</p>
{% endif %}

<!-- Summary -->
<table style="margin-top: 30px; background-color: #f8f9fa;">
    <tr>
        <td style="padding: 15px;">
            <h3 style="margin-top: 0;">Συνοπτικά Στοιχεία</h3>
            <p style="margin: 5px 0;">
                <strong>Ποσοστό Ολοκλήρωσης:</strong> {{ stats.completion_rate }}%
            </p>
            <p style="margin: 5px 0;">
                <strong>Κατάσταση Πελάτη:</strong>
                {% if client.is_active %}
                <span class="text-success">Ενεργός</span>
                {% else %}
                <span class="text-danger">Ανενεργός</span>
                {% endif %}
            </p>
        </td>
    </tr>
</table>
{% endblock %}
