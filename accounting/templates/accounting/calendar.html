{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}{{ title }} | LogistikoCRM{% endblock %}

{% block extrastyle %}
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
<link href="{% static 'accounting/css/calendar.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="calendar-container">
    <!-- Quick Navigation Bar -->
    <nav class="quick-nav-bar">
        <a href="{% url 'admin:index' %}">ğŸ  Admin</a>
        <span class="nav-separator">â€º</span>
        <a href="{% url 'accounting:dashboard' %}">ğŸ“Š Dashboard</a>
        <span class="nav-separator">â€º</span>
        <span class="nav-current">ğŸ“… Î—Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿</span>
    </nav>

    <!-- Statistics Box -->
    <div class="calendar-stats">
        <div class="stat-box pending">
            <span class="stat-number">{{ stats.pending_count }}</span>
            <span class="stat-label">Î•ÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚</span>
        </div>
        <div class="stat-box overdue">
            <span class="stat-number">{{ stats.overdue_count }}</span>
            <span class="stat-label">Î•ÎºÏ€ÏÏŒÎ¸ÎµÏƒÎ¼ÎµÏ‚</span>
        </div>
        <div class="stat-box completed">
            <span class="stat-number">{{ stats.completed_this_month }}</span>
            <span class="stat-label">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎ±Î½</span>
        </div>
    </div>

    <!-- Header with filters -->
    <div class="calendar-header">
        <h1>ğŸ“… Î—Î¼ÎµÏÎ¿Î»ÏŒÎ³Î¹Î¿ Î¥Ï€Î¿Ï‡ÏÎµÏÏƒÎµÏ‰Î½</h1>

        <!-- Filters -->
        <div class="calendar-filters">
            <select id="filter-client" class="filter-select">
                <option value="">ÎŒÎ»Î¿Î¹ Î¿Î¹ Ï€ÎµÎ»Î¬Ï„ÎµÏ‚</option>
                {% for client in clients %}
                <option value="{{ client.id }}">{{ client.eponimia }}</option>
                {% endfor %}
            </select>

            <select id="filter-type" class="filter-select">
                <option value="">ÎŒÎ»Î¿Î¹ Î¿Î¹ Ï„ÏÏ€Î¿Î¹</option>
                {% for type in obligation_types %}
                <option value="{{ type.id }}">{{ type.name }}</option>
                {% endfor %}
            </select>

            <select id="filter-status" class="filter-select">
                <option value="">ÎŒÎ»ÎµÏ‚ Î¿Î¹ ÎºÎ±Ï„Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚</option>
                <option value="pending">Î•ÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚</option>
                <option value="completed">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½ÎµÏ‚</option>
                <option value="overdue">Î•ÎºÏ€ÏÏŒÎ¸ÎµÏƒÎ¼ÎµÏ‚</option>
            </select>

            <button id="clear-filters" class="btn-clear-filters" title="ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚ Ï†Î¯Î»Ï„ÏÏ‰Î½">
                âœ• ÎšÎ±Î¸Î±ÏÎ¹ÏƒÎ¼ÏŒÏ‚
            </button>
        </div>
    </div>

    <!-- Legend -->
    <div class="calendar-legend">
        <span class="legend-item">
            <span class="dot pending"></span>
            Î•ÎºÎºÏÎµÎ¼ÎµÎ¯Ï‚
        </span>
        <span class="legend-item">
            <span class="dot overdue"></span>
            Î•ÎºÏ€ÏÏŒÎ¸ÎµÏƒÎ¼ÎµÏ‚
        </span>
        <span class="legend-item">
            <span class="dot completed"></span>
            ÎŸÎ»Î¿ÎºÎ»Î·ÏÏ‰Î¼Î­Î½ÎµÏ‚
        </span>
        <span class="legend-item">
            <span class="dot today"></span>
            Î£Î®Î¼ÎµÏÎ±
        </span>
    </div>

    <!-- Calendar Container -->
    <div id="calendar"></div>

    <!-- Event Detail Modal -->
    <div id="event-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2 id="modal-title"></h2>
            <div id="modal-body">
                <div class="modal-row">
                    <span class="modal-label">Î ÎµÎ»Î¬Ï„Î·Ï‚:</span>
                    <span id="modal-client" class="modal-value"></span>
                </div>
                <div class="modal-row">
                    <span class="modal-label">Î‘Î¦Îœ:</span>
                    <span id="modal-afm" class="modal-value"></span>
                </div>
                <div class="modal-row">
                    <span class="modal-label">Î¤ÏÏ€Î¿Ï‚:</span>
                    <span id="modal-type" class="modal-value"></span>
                </div>
                <div class="modal-row">
                    <span class="modal-label">Î ÎµÏÎ¯Î¿Î´Î¿Ï‚:</span>
                    <span id="modal-period" class="modal-value"></span>
                </div>
                <div class="modal-row">
                    <span class="modal-label">Î ÏÎ¿Î¸ÎµÏƒÎ¼Î¯Î±:</span>
                    <span id="modal-deadline" class="modal-value"></span>
                </div>
                <div class="modal-row">
                    <span class="modal-label">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·:</span>
                    <span id="modal-status" class="modal-value"></span>
                </div>
                <div class="modal-row notes-row" id="modal-notes-row">
                    <span class="modal-label">Î£Î·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚:</span>
                    <span id="modal-notes" class="modal-value modal-notes"></span>
                </div>
            </div>
            <div class="modal-actions">
                <a id="modal-edit-btn" href="#" class="btn btn-primary">
                    âœï¸ Î•Ï€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±
                </a>
                <button id="modal-complete-btn" class="btn btn-success">
                    âœ… ÎŸÎ»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ·
                </button>
                <a id="modal-client-btn" href="#" class="btn btn-secondary">
                    ğŸ‘¤ Î ÏÎ¿Ï†Î¯Î» Î ÎµÎ»Î¬Ï„Î·
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extrajs %}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
<script src="{% static 'accounting/js/calendar.js' %}"></script>
{% endblock %}
