{% extends "base.html" %}
{% load static %}

{% block title %}VoIP ÎšÎ»Î®ÏƒÎµÎ¹Ï‚{% endblock %}

{% block content %}
<div class="container mx-auto py-6 px-4">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">ğŸ“ VoIP ÎšÎ»Î®ÏƒÎµÎ¹Ï‚</h1>
        <p class="text-gray-600 mt-2">Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÎºÎ±Î¹ Ï€Î±ÏÎ±ÎºÎ¿Î»Î¿ÏÎ¸Î·ÏƒÎ· Ï„Î·Î»ÎµÏ†Ï‰Î½Î¹ÎºÏÎ½ ÎºÎ»Î®ÏƒÎµÏ‰Î½</p>
    </div>

    <!-- Stats Row -->
    <div class="grid grid-cols-4 gap-4 mb-6">
        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
            <p class="text-gray-600 text-sm">Î£ÏÎ½Î¿Î»Î¿ ÎšÎ»Î®ÏƒÎµÏ‰Î½</p>
            <p class="text-3xl font-bold text-blue-600">{{ total }}</p>
        </div>
        <div class="bg-red-50 p-4 rounded-lg border border-red-200">
            <p class="text-gray-600 text-sm">Î‘Î½Î±Ï€Î¬Î½Ï„Î·Ï„ÎµÏ‚</p>
            <p class="text-3xl font-bold text-red-600">{{ missed }}</p>
        </div>
        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
            <p class="text-gray-600 text-sm">ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµÏ‚</p>
            <p class="text-3xl font-bold text-green-600">{{ completed }}</p>
        </div>
        <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
            <p class="text-gray-600 text-sm">Î Î¿ÏƒÎ¿ÏƒÏ„ÏŒ Î•Ï€Î¹Ï„Ï…Ï‡Î¯Î±Ï‚</p>
            <p class="text-3xl font-bold text-purple-600">{{ success_rate }}%</p>
        </div>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-lg font-semibold mb-4">ğŸ” Î¦Î¯Î»Ï„ÏÎ±</h2>
        <form method="get" class="grid grid-cols-4 gap-4">
            <!-- Search -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·</label>
                <input type="text"
                       name="search"
                       value="{{ request.GET.search }}"
                       placeholder="Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚, Ï€ÎµÎ»Î¬Ï„Î·Ï‚..."
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg" />
            </div>

            <!-- Status -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</label>
                <select name="status" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    <option value="">ÎŒÎ»ÎµÏ‚</option>
                    <option value="missed" {% if request.GET.status= ="missed" %}selected{% endif %}>Î‘Î½Î±Ï€Î¬Î½Ï„Î·Ï„ÎµÏ‚</option>
                    <option value="completed" {% if request.GET.status= ="completed" %}selected{% endif %}>ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµÏ‚</option>
                    <option value="active" {% if request.GET.status= ="active" %}selected{% endif %}>Î•Î½ÎµÏÎ³Î­Ï‚</option>
                </select>
            </div>

            <!-- Direction -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">ÎšÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ·</label>
                <select name="direction" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                    <option value="">ÎŒÎ»ÎµÏ‚</option>
                    <option value="incoming" {% if request.GET.direction= ="incoming" %}selected{% endif %}>Î•Î¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½ÎµÏ‚</option>
                    <option value="outgoing" {% if request.GET.direction= ="outgoing" %}selected{% endif %}>Î•Î¾ÎµÏÏ‡ÏŒÎ¼ÎµÎ½ÎµÏ‚</option>
                </select>
            </div>

            <!-- Button -->
            <div class="flex items-end gap-2">
                <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
                    ğŸ” Î‘Î½Î±Î¶Î®Ï„Î·ÏƒÎ·
                </button>
                <a href="{% url 'voip_calls_list' %}" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 font-medium">
                    Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬
                </a>
            </div>
        </form>
    </div>

    <!-- Calls Table -->
    <div class="bg-white rounded-lg shadow overflow-hidden">
        <table class="w-full">
            <thead class="bg-gray-100 border-b">
                <tr>
                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±/ÎÏÎ±</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Î‘ÏÎ¹Î¸Î¼ÏŒÏ‚</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Î ÎµÎ»Î¬Ï„Î·Ï‚</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Email</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">ÎšÎ±Ï„ÎµÏÎ¸Ï…Î½ÏƒÎ·</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·</th>
                    <th class="px-6 py-3 text-left text-sm font-semibold text-gray-700">Î”Î¹Î¬ÏÎºÎµÎ¹Î±</th>
                </tr>
            </thead>
            <tbody>
                {% for call in calls %}
                <tr class="border-b hover:bg-gray-50 transition">
                    <td class="px-6 py-4 text-sm text-gray-800">
                        {{ call.started_at|date:"d/m/Y H:i" }}
                    </td>
                    <td class="px-6 py-4 text-sm font-medium text-gray-800">
                        <a href="tel:{{ call.phone_number }}" class="text-blue-600 hover:text-blue-800">
                            {{ call.phone_number }}
                        </a>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-800">
                        {% if call.client %}
                        <a href="/admin/accounting/clientprofile/{{ call.client.id }}/change/" class="text-blue-600 hover:text-blue-800">
                            {{ call.client.eponimia }}
                        </a>
                        {% else %}
                        <span class="text-gray-400">â€”</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-600">
                        {% if call.client_email %}
                        <a href="mailto:{{ call.client_email }}" class="text-blue-600 hover:text-blue-800">
                            {{ call.client_email|truncatechars:25 }}
                        </a>
                        {% else %}
                        <span class="text-gray-400">â€”</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm">
                        {% if call.direction == "incoming" %}
                        <span class="text-lg">ğŸ“² Î•Î¹ÏƒÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î·</span>
                        {% else %}
                        <span class="text-lg">â˜ï¸ Î•Î¾ÎµÏÏ‡ÏŒÎ¼ÎµÎ½Î·</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4">
                        {% if call.status == "missed" %}
                        <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium border border-red-300">
                            âŒ Î‘Î½Î±Ï€Î¬Î½Ï„Î·Ï„Î·
                        </span>
                        {% elif call.status == "completed" %}
                        <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium border border-green-300">
                            âœ… ÎŸÎ»Î¿ÎºÎ»Î·ÏÏÎ¸Î·ÎºÎµ
                        </span>
                        {% else %}
                        <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-xs font-medium border border-blue-300">
                            ğŸ”µ {{ call.get_status_display }}
                        </span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm font-medium text-gray-800">
                        {{ call.duration_formatted }}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                        Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÎºÎ»Î®ÏƒÎµÎ¹Ï‚
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Footer -->
    <div class="mt-6 text-center text-sm text-gray-600">
        Î•Î¼Ï†Î¬Î½Î¹ÏƒÎ· <strong>{{ calls|length }}</strong> ÎºÎ»Î®ÏƒÎµÏ‰Î½ Î±Ï€ÏŒ ÏƒÏÎ½Î¿Î»Î¿ <strong>{{ total }}</strong>
    </div>

    <!-- Admin Link -->
    <div class="mt-8 text-center">
        <a href="/admin/accounting/voipcall/" class="inline-block px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium">
            âš™ï¸ Î”Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ· ÏƒÏ„Î¿ Admin
        </a>
    </div>
</div>

<style>
    * {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
    }

    :root {
        --primary: #667eea;
        --secondary: #764ba2;
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --text-primary: #111827;
        --text-secondary: #6b7280;
    }

    html {
        font-size: 16px;
    }

    body {
        font-family: var(--ff-base);
        font-size: 1rem;
        line-height: 1.5;
        color: var(--text-primary);
    }

    h1 {
        font-size: 2rem;
        font-weight: 800;
    }

    h2 {
        font-size: 1.5rem;
        font-weight: 700;
    }

    @media (max-width: 768px) {
        html {
            font-size: 14px;
        }

        h1 {
            font-size: 1.5rem;
        }

        h2 {
            font-size: 1.25rem;
        }
    }

    ```

    ---

    ## **Î¤Î‘ Î¥Î ÎŸÎ›ÎŸÎ™Î Î‘ (5-6):**
    ```
    5. âœ… CRM Integration - Î‰Î´Î· ÎºÎ¬Î½ÎµÎ¹ (select_related)
    6. âœ… Email Automation - Î‰Î´Î· ÎºÎ¬Î½ÎµÎ¹ (Django mail)
    7. âœ… UI Styling - ÎšÎ¬Î½Î¿Ï…Î¼Îµ Ï„ÏÏÎ±
    .container {
        max-width: 1280px;
        margin: 0 auto;
    }

    .grid {
        display: grid;
    }

    .grid-cols-4 {
        grid-template-columns: repeat(4, minmax(0, 1fr));
    }

    .gap-4 {
        gap: 1rem;
    }

    .gap-2 {
        gap: 0.5rem;
    }

    .mb-6 {
        margin-bottom: 1.5rem;
    }

    .mb-4 {
        margin-bottom: 1rem;
    }

    .mb-2 {
        margin-bottom: 0.5rem;
    }

    .mt-6 {
        margin-top: 1.5rem;
    }

    .mt-8 {
        margin-top: 2rem;
    }

    .mt-2 {
        margin-top: 0.5rem;
    }

    .px-4 {
        padding: 0 1rem;
    }

    .px-6 {
        padding: 0 1.5rem;
    }

    .py-2 {
        padding: 0.5rem 0;
    }

    .py-3 {
        padding: 0.75rem 0;
    }

    .py-4 {
        padding: 1rem 0;
    }

    .py-6 {
        padding: 1.5rem 0;
    }

    .py-8 {
        padding: 2rem 0;
    }

    .rounded-lg {
        border-radius: 0.5rem;
    }

    .rounded-full {
        border-radius: 9999px;
    }

    .border {
        border: 1px solid;
    }

    .border-b {
        border-bottom: 1px solid;
    }

    .border-gray-300 {
        border-color: #d1d5db;
    }

    .border-gray-200 {
        border-color: #e5e7eb;
    }

    .border-blue-200 {
        border-color: #bfdbfe;
    }

    .border-red-200 {
        border-color: #fecaca;
    }

    .border-red-300 {
        border-color: #fca5a5;
    }

    .border-green-200 {
        border-color: #bbf7d0;
    }

    .border-green-300 {
        border-color: #86efac;
    }

    .border-purple-200 {
        border-color: #e9d5ff;
    }

    .bg-white {
        background: white;
    }

    .bg-gray-50 {
        background: #f9fafb;
    }

    .bg-gray-100 {
        background: #f3f4f6;
    }

    .bg-gray-300 {
        background: #d1d5db;
    }

    .bg-gray-400 {
        background: #9ca3af;
    }

    .bg-blue-50 {
        background: #eff6ff;
    }

    .bg-blue-100 {
        background: #dbeafe;
    }

    .bg-blue-600 {
        background: #2563eb;
    }

    .bg-blue-700 {
        background: #1d4ed8;
    }

    .bg-red-50 {
        background: #fef2f2;
    }

    .bg-red-100 {
        background: #fee2e2;
    }

    .bg-red-800 {
        background: #991b1b;
    }

    .bg-green-50 {
        background: #f0fdf4;
    }

    .bg-green-100 {
        background: #dcfce7;
    }

    .bg-green-600 {
        background: #16a34a;
    }

    .bg-green-800 {
        background: #15803d;
    }

    .bg-purple-50 {
        background: #faf5ff;
    }

    .bg-purple-600 {
        background: #9333ea;
    }

    .text-sm {
        font-size: 0.875rem;
    }

    .text-lg {
        font-size: 1.125rem;
    }

    .text-3xl {
        font-size: 1.875rem;
    }

    .font-medium {
        font-weight: 500;
    }

    .font-semibold {
        font-weight: 600;
    }

    .font-bold {
        font-weight: 700;
    }

    .text-center {
        text-align: center;
    }

    .text-left {
        text-align: left;
    }

    .text-gray-500 {
        color: #6b7280;
    }

    .text-gray-600 {
        color: #4b5563;
    }

    .text-gray-700 {
        color: #374151;
    }

    .text-gray-800 {
        color: #1f2937;
    }

    .text-gray-900 {
        color: #111827;
    }

    .text-gray-400 {
        color: #9ca3af;
    }

    .text-blue-600 {
        color: #2563eb;
    }

    .text-blue-800 {
        color: #1e40af;
    }

    .text-red-600 {
        color: #dc2626;
    }

    .text-red-800 {
        color: #991b1b;
    }

    .text-green-600 {
        color: #16a34a;
    }

    .text-green-800 {
        color: #15803d;
    }

    .text-purple-600 {
        color: #9333ea;
    }

    .text-white {
        color: white;
    }

    .hover\:bg-blue-700:hover {
        background: #1d4ed8;
    }

    .hover\:bg-gray-400:hover {
        background: #9ca3af;
    }

    .hover\:bg-gray-50:hover {
        background: #f9fafb;
    }

    .hover\:text-blue-800:hover {
        color: #1e40af;
    }

    .shadow {
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .overflow-hidden {
        overflow: hidden;
    }

    .transition {
        transition: all 150ms;
    }

    .inline-block {
        display: inline-block;
    }

    .w-full {
        width: 100%;
    }

    .flex {
        display: flex;
    }

    .flex-1 {
        flex: 1;
    }

    .items-end {
        align-items: flex-end;
    }
</style>
{% endblock %}